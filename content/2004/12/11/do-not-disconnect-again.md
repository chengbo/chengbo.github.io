---
author: chengbo
comments: true
date: 2004-12-11 11:12:56+00:00
layout: post
title: 学校的破网，你别再掉了
---


学校的校园网老是掉线，平均5分钟就要掉一次，而且要过个2分钟的样子才能重新连接起，真的让人很烦躁。朋友告诉我可以一个方法可以不再掉线，试了一下果然不错，在网上搜索了一下，学习了一下原理，现在写出来，让大家共享。

我们要访问一个网站，通常是在游览器里输入这个网站的网址，然后回车，这个时候，DNS服务器会自动把它解析成IP地址，实际上我们是通过IP来访问网站的，网址只不过是助记符罢了。那么在局域网中，以太网设备并不认识IP地址，所以还要将IP地址转换成MAC地址，ARP（Address Resolution Protocol）就是进行这种转换的协议。

因特网是通过TCP/IP进行信息交换的，所以要上网，必须安装TCP/IP协议，在每台安装了此协议的电脑里，都有一个ARP缓存表，表里的IP地址和MAC地址是一一对应的：

| IP地址      | MAC地址          |
| ----------| -------------- |
| 10.6.13.1 | 00-00-00-00-01 |
| 10.6.13.2 | 00-00-00-00-02 |
| 10.6.13.3 | 00-00-00-00-03 |
| ...       | ...            |

当10.6.13.2要向10.6.13.1发送信息时，首先在ARP缓存表里查找是否有10.6.13.1的MAC地址，如果有，就直接进行通信，如果没有，就要在网络上发送一个广播信息，询问10.6.13.1的MAC地址，这时，其它电脑并不响应询问，只有10.6.13.1响应，它把自己的MAC地址发送给10.6.13.2，这样，10.6.13.2就知道10.6.13.1的MAC地址了，它们之间就可以进行通信了，同时，10.6.13.2也更新了自己的ARP缓存表，下次通信时就可以直接从中取出10.6.13.1的MAC地址进行通信了。ARP缓存表还采用了老化机制，在一段时间里如果某一行没有使用，就会被删除，这样就大大减小了表的长度，加快了查询速度。

那么什么又是网关呢？

顾名思义，网关(Gateway)就是一个网络连接到另一个网络的“关口”。

按照不同的分类标准，网关也有很多种。TCP/IP协议里的网关是最常用的，在这里我们所讲的“网关”均指TCP/IP协议下的网关。

那么网关到底是什么呢？网关实质上是一个网络通向其他网络的IP地址。比如有网络A和网络B，网络A的IP地址范围为“192.168.1.1~192. 168.1.254”，子网掩码为255.255.255.0；网络B的IP地址范围为“192.168.2.1~192.168.2.254”，子网掩码为255.255.255.0。在没有路由器的情况下，两个网络之间是不能进行TCP/IP通信的，即使是两个网络连接在同一台交换机(或集线器)上，TCP/IP协议也会根据子网掩码(255.255.255.0)判定两个网络中的主机处在不同的网络里。而要实现这两个网络之间的通信，则必须通过网关。如果网络A中的主机发现数据包的目的主机不在本地网络中，就把数据包转发给它自己的网关，再由网关转发给网络B的网关，网络B的网关再转发给网络B的某个主机。网络B向网络A转发数据包的过程也是如此。

所以说，只有设置好网关的IP地址，TCP/IP协议才能实现不同网络之间的相互通信。那么这个IP地址是哪台机器的IP地址呢？网关的IP地址是具有路由功能的设备的IP地址，具有路由功能的设备有路由器、启用了路由协议的服务器(实质上相当于一台路由器)、代理服务器(也相当于一台路由器)。

呵呵，是不是有点头晕，搞不清哪个是哪个了？说实话，我自己都有点晕，其实上面的东西不理解也没关系，因为一般用户只需要使用，不需要理解，理解是网管们的事。

现在我们来实际操作一下

点击“开始”-“运行”-输入cmd，回车

在命令提示符下输入arp –a

![](http://www.pconline.com.cn/pcedu/soft/lan/jywrm/10306/pic/030605zw_02.jpg)

如上图，192.168.1.1的物理地址（MAC地址）是00-aa-00-62-c6-09，type是dynamic（这是我绑定后截的图，所以是static）。记下它的MAC，然后输入arp –s 192.168.1.1 00-aa-00-62-c6-09，这样就在你的ARP缓存表里添加了一个192.168.1.1到00-aa-00-62-c6-09的对应关系。

在我们学校（西华大学），如果你不想了解上面那些，只是不想掉线，那就跟我一步一步来

1 在命令提示符中输入"arp -a" 这时有可能得到很多IP和它的MAC，但注意了，我们只想得到网关MAC（一般网关是当前网段最开始的那个IP，比如我通过DHCP得到的IP是10.6.13.6，那么网关就是10.6.13.1）

2 输入"arp -s 网关IP 网关MAC"

3 输入"exit"退出

4 搞定

---------------------

提示：Arp –d命令还可以删除一个对应关系。

我观察了一下，没有绑定之前，网关的IP和MAC地址是dynamic（动态的），掉线时是invalid（无效的），绑定之后就是static（静态的）了。我还不太搞得懂为什么在我掉线了，过一段时间ARP缓存表自动刷新以后，网关的MAC地址就变了。但是我一旦把它绑定到我的表里后，今天一天都没有掉线，而我的室友掉了N回！而且我也不知道为什么隔一段时间网关的的type就变invalid的了，致使我掉线，难道是有人在搞破坏？发个包过来改我的缓存表（可以arp欺骗）？搞不太懂。

以前没怎么注意网络协议和配置这方面，看来以后要多多学习了。
